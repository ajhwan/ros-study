# 5월 9일

## Service 통신
- 서버와 클라이언트 사이에 통신이 일어나는 것
- 1대1 통신으로 요청과 동시에 응답이 발생함
  - 통신이 한번 이루어지면 통신이 종료됨
- 서버에서 클라이언트로, 클라이언트에서 서버로의 통신으로 양방향 통신
- 동기 통신으로 서버가 먼저 켜져 있어야 한다.
  - 요청을 보냈을 때 응답을 보낼 수 있음
- 요청을 보내는 순간 통신이 시작되는 동기통신임
- request를 한번 보내면 response가 올 때까지 아무것도 하지 않음
  - 긴 작업이 필요할 때면 service 통신의 사용을 지양함

### 2개의 숫자를 보내서 더하고 response 하기

#### 1.cpp

> 1. 'cs' 입력하고서 이동
> 2. catkin_create_pkg sevice_tutorial roscpp rospy std_msgs message_generation message_runtime 패키지 생성
> 3. service_tutorial폴더 안에 srv폴더를 생성
> 4. AddTwoInts.srv파일을 생성
> 5. src폴더에 my_client.cpp파일을 생성
> 6. my_server.cpp파일을 생성
> 7. CMakeLists.txt수정을 한다. Declare ROS messages, services and actions로 이동
> 8. Generate services in the 'srv' folder의 주석을 해제
> 9. Generate added messages and services with any dependencies listed here의 주석을 해제
> 10. Build부분 이동 후 (executable, dependencies, link_libraries)를 수정
> 11. 'cm' 빌드 이후, roscore, rosrun service_tutorial my_client <숫자> <숫자>, rosrun service_tutorial my_server를 각각 터미널에서 실행

> srv폴더 생성 후 AddTwoInts.srv파일 생성

![Screenshot from 2023-05-09 09-53-32](https://user-images.githubusercontent.com/129160008/236978722-655df80d-948e-4516-9257-edadd1aaa29e.png)

> my_client.cpp

![Screenshot from 2023-05-09 11-18-14](https://user-images.githubusercontent.com/129160008/236978725-d4492767-6b18-4429-9d76-f42060a75757.png)

> my_server.cpp

![Screenshot from 2023-05-09 11-18-26](https://user-images.githubusercontent.com/129160008/236978731-63deacd4-7ecf-4653-8630-878024158626.png)

> 실행 결과

![Screenshot from 2023-05-09 11-19-20](https://user-images.githubusercontent.com/129160008/236978733-bc065123-d26f-4477-a830-8e7e6dd432dd.png)

> server가 꺼진 상태로 client가 요청을 보낼 시 오류가 발생

![Screenshot from 2023-05-09 11-35-23](https://user-images.githubusercontent.com/129160008/236979773-8df4bbdb-b5d8-452c-a6a6-ccf0a560a506.png)

- server가 켜져 있어야 통신이 가능(request를 대기)
- 이후 client가 정수 2개를 보내면 합을 보냄(response)

#### 2.python 

> 1. service_tutorial안에 scripts 폴더를 생성
> 2. py_client.py파일을 생성
> 3. py_server.py파일을 생성
> 4. CMakeLists.txt에 Install부분 수정 (catkin_install_python)을 수정

> py_client.py

![Screenshot from 2023-05-09 12-13-58](https://user-images.githubusercontent.com/129160008/236984952-a56dd21a-b509-4bb1-9c19-ed4f61017bb5.png)

> py_server.py

![Screenshot from 2023-05-09 12-14-07](https://user-images.githubusercontent.com/129160008/236984956-5524ff23-dccd-4f6e-ab22-a5cf0abf9555.png)

> 실행 결과

![Screenshot from 2023-05-09 12-13-45](https://user-images.githubusercontent.com/129160008/236984959-874dc379-e8ba-4097-ba1d-041569ca87fc.png)

- cpp server를 실행시키고 python client를 실행해도 정상적으로 실행
- python server를 실행시키고 cpp client를 실행해도 정상적으로 실행
- 언어와 상관없이 잘 작동이 됨
  - 하지만 1대1 통신이므로 server를 여러개 켜놔도 매치가 된 server와 client 사이에서만 통신을 함

![Screenshot from 2023-05-09 12-19-53](https://user-images.githubusercontent.com/129160008/236986922-d5fbc39e-a683-49bd-92cb-a2a48288b98d.png)

### 2개의 숫자를 보내서 곱해서 response 하기

- 앞서 생성했던 AddTwoInts.srv 파일을 그대로 사용

#### cpp
> 1. catkin_create_pkg service_second roscpp rospy service_tutorial
> 2. client_second.cpp파일을 생성
> 3. server_second.cpp파일을 생성
> 4. CMakeLists.txt를 수정 Declare ROS messages, services and actions는 service_tutorial에서 불러와서 수정안함.
> 5. executable, dependencies, link_libraries 3곳만 수정

> pkg 생성

![Screenshot from 2023-05-09 12-46-34](https://user-images.githubusercontent.com/129160008/237000438-cac7fde8-a77a-43ed-8287-d453ff1e44c7.png)

- 앞서 만들었던 service_tutorial을 의존성으로 사용

> client_second.cpp

![Screenshot from 2023-05-09 14-11-02](https://user-images.githubusercontent.com/129160008/237000447-7de3307f-ddf4-4193-a3c9-16ee6cfde0a2.png)

> server_second.cpp

![Screenshot from 2023-05-09 14-11-11](https://user-images.githubusercontent.com/129160008/237000449-8a7adb28-b83e-4a07-8b88-30e103866d20.png)

> 실행 결과

![Screenshot from 2023-05-09 14-10-46](https://user-images.githubusercontent.com/129160008/237000444-7e074dce-0b91-472d-bb91-c78a7d439f34.png)


## parameter 통신

### 2개의 숫자를 보내서 사칙연산 계산하기

#### cpp

> calculate_client.cpp



> calculate_server.cpp



> 실행 결과



> 마이너스로 바꾸고 실행 결과



